# Домашнее задание к занятию 2. «SQL»## ВведениеПеред выполнением задания вы можете ознакомиться с [дополнительными материалами](https://github.com/netology-code/virt-homeworks/blob/virt-11/additional/README.md).## Задача 1Используя Docker, поднимите инстанс PostgreSQL (версию 12) c 2 volume, в который будут складываться данные БД и бэкапы.Приведите получившуюся команду или docker-compose-манифест.```version: "3"services:  sql-02_postgres:    image: postgres:latest    container_name: sql-02_postgres    ports:    - 5432:5432    volumes:    - ./pg_data:/var/lib/postgresql/data/pgdata    - ./backup:/var/lib/postgresql/data/backup    environment:      POSTGRES_PASSWORD: 123      PGDATA: /var/lib/postgresql/data/pgdata # Путь внутри контейнера, где будет папка pgdata    restart: always```## Задача 2В БД из задачи 1: - создайте пользователя test-admin-user и БД test_db;- в БД test_db создайте таблицу orders и clients (спeцификация таблиц ниже);- предоставьте привилегии на все операции пользователю test-admin-user на таблицы БД test_db;- создайте пользователя test-simple-user;- предоставьте пользователю test-simple-user права на SELECT/INSERT/UPDATE/DELETE этих таблиц БД test_db.Таблица orders:- id (serial primary key);- наименование (string);- цена (integer).Таблица clients:- id (serial primary key);- фамилия (string);- страна проживания (string, index);- заказ (foreign key orders).Приведите:- итоговый список БД после выполнения пунктов выше;```test_db=# \l+                                                                                        List of databases   Name    |  Owner   | Encoding | Locale Provider |  Collate   |   Ctype    | ICU Locale | ICU Rules |   Access privileges   |  Size   | Tablespace |                Description                 -----------+----------+----------+-----------------+------------+------------+------------+-----------+-----------------------+---------+------------+-------------------------------------------- postgres  | postgres | UTF8     | libc            | en_US.utf8 | en_US.utf8 |            |           |                       | 7492 kB | pg_default | default administrative connection database template0 | postgres | UTF8     | libc            | en_US.utf8 | en_US.utf8 |            |           | =c/postgres          +| 7337 kB | pg_default | unmodifiable empty database           |          |          |                 |            |            |            |           | postgres=CTc/postgres |         |            |  template1 | postgres | UTF8     | libc            | en_US.utf8 | en_US.utf8 |            |           | =c/postgres          +| 7556 kB | pg_default | default template for new databases           |          |          |                 |            |            |            |           | postgres=CTc/postgres |         |            |  test_db   | postgres | UTF8     | libc            | en_US.utf8 | en_US.utf8 |            |           |                       | 7668 kB | pg_default | (4 rows)```- описание таблиц (describe);```test_db=# \d+ clients                                                                    Table "public.clients"      Column       |          Type          | Collation | Nullable |               Default               | Storage  | Compression | Stats target | Description -------------------+------------------------+-----------+----------+-------------------------------------+----------+-------------+--------------+------------- id                | integer                |           | not null | nextval('clients_id_seq'::regclass) | plain    |             |              |  ФИО               | character varying(200) |           | not null |                                     | extended |             |              |  страна проживания | character varying(200) |           | not null |                                     | extended |             |              |  заказ             | smallint               |           |          |                                     | plain    |             |              | Indexes:    "clients_pkey" PRIMARY KEY, btree (id)Foreign-key constraints:    "clients_заказ_fkey" FOREIGN KEY ("заказ") REFERENCES orders(id)Access method: heaptest_db=# \d+ orders                                                                  Table "public.orders"    Column    |          Type          | Collation | Nullable |              Default               | Storage  | Compression | Stats target | Description --------------+------------------------+-----------+----------+------------------------------------+----------+-------------+--------------+------------- id           | integer                |           | not null | nextval('orders_id_seq'::regclass) | plain    |             |              |  наименование | character varying(100) |           | not null |                                    | extended |             |              |  цена         | integer                |           |          |                                    | plain    |             |              | Indexes:    "orders_pkey" PRIMARY KEY, btree (id)Referenced by:    TABLE "clients" CONSTRAINT "clients_заказ_fkey" FOREIGN KEY ("заказ") REFERENCES orders(id)Access method: heap```- SQL-запрос для выдачи списка пользователей с правами над таблицами test_db;```SELECT grantee, privilege_type FROM information_schema.role_table_grants WHERE table_name='clients';```- список пользователей с правами над таблицами test_db.```test_db=# SELECT grantee, privilege_type FROM information_schema.role_table_grants WHERE table_name='clients';     grantee      | privilege_type ------------------+---------------- postgres         | INSERT postgres         | SELECT postgres         | UPDATE postgres         | DELETE postgres         | TRUNCATE postgres         | REFERENCES postgres         | TRIGGER test-simple-user | INSERT test-simple-user | SELECT test-simple-user | UPDATE test-simple-user | DELETE test-admin-user  | INSERT test-admin-user  | SELECT test-admin-user  | UPDATE test-admin-user  | DELETE test-admin-user  | TRUNCATE test-admin-user  | REFERENCES test-admin-user  | TRIGGER(18 rows)test_db=# SELECT grantee, privilege_type FROM information_schema.role_table_grants WHERE table_name='orders';     grantee      | privilege_type ------------------+---------------- postgres         | INSERT postgres         | SELECT postgres         | UPDATE postgres         | DELETE postgres         | TRUNCATE postgres         | REFERENCES postgres         | TRIGGER test-simple-user | INSERT test-simple-user | SELECT test-simple-user | UPDATE test-simple-user | DELETE test-admin-user  | INSERT test-admin-user  | SELECT test-admin-user  | UPDATE test-admin-user  | DELETE test-admin-user  | TRUNCATE test-admin-user  | REFERENCES test-admin-user  | TRIGGER(18 rows)```## Задача 3Используя SQL-синтаксис, наполните таблицы следующими тестовыми данными:Таблица orders|Наименование|цена||------------|----||Шоколад| 10 ||Принтер| 3000 ||Книга| 500 ||Монитор| 7000||Гитара| 4000|Таблица clients|ФИО|Страна проживания||------------|----||Иванов Иван Иванович| USA ||Петров Петр Петрович| Canada ||Иоганн Себастьян Бах| Japan ||Ронни Джеймс Дио| Russia||Ritchie Blackmore| Russia|Используя SQL-синтаксис:- вычислите количество записей для каждой таблицы.Приведите в ответе:    - запросы,    - результаты их выполнения.```test_db=# INSERT INTO orders (наименование, цена) VALUES        ('Шоколад', 10),        ('Принтер', 3000),        ('Книга', 500),        ('Монитор', 7000),        ('Гитара', 4000);INSERT 0 5test_db=# SELECT * FROM orders; id | наименование | цена ----+--------------+------  1 | Шоколад      |   10  2 | Принтер      | 3000  3 | Книга        |  500  4 | Монитор      | 7000  5 | Гитара       | 4000(5 rows)test_db=# INSERT INTO clients (ФИО, "страна проживания") VALUES        ('Иванов Иван Иванович', 'USA'),        ('Петров Петр Петрович', 'Canada'),        ('Иоганн Себастьян Бах', 'Japan'),        ('Ронни Джеймс Дио', 'Russia'),        ('Ritchie Blackmore', 'Russia');INSERT 0 5test_db=# SELECT * FROM clients; id |         ФИО          | страна проживания | заказ ----+----------------------+-------------------+-------  1 | Иванов Иван Иванович | USA               |        2 | Петров Петр Петрович | Canada            |        3 | Иоганн Себастьян Бах | Japan             |        4 | Ронни Джеймс Дио     | Russia            |        5 | Ritchie Blackmore    | Russia            |      (5 rows)test_db=# SELECT COUNT(*) FROM clients; count -------     5(1 row)test_db=# SELECT COUNT(*) FROM orders; count -------     5(1 row)```## Задача 4Часть пользователей из таблицы clients решили оформить заказы из таблицы orders.Используя foreign keys, свяжите записи из таблиц, согласно таблице:|ФИО|Заказ||------------|----||Иванов Иван Иванович| Книга ||Петров Петр Петрович| Монитор ||Иоганн Себастьян Бах| Гитара |Приведите SQL-запросы для выполнения этих операций.```test_db=# UPDATE clients SET заказ = (        SELECT id FROM orders WHERE наименование = 'Книга')         WHERE ФИО = 'Иванов Иван Иванович';UPDATE 1test_db=# UPDATE clients SET заказ = (        SELECT id FROM orders WHERE наименование = 'Монитор')         WHERE ФИО = 'Петров Петр Петрович';UPDATE 1test_db=# UPDATE clients SET заказ = (        SELECT id FROM orders WHERE наименование = 'Гитара')         WHERE ФИО = 'Иоганн Себастьян Бах';UPDATE 1```Приведите SQL-запрос для выдачи всех пользователей, которые совершили заказ, а также вывод этого запроса.-```test_db=# SELECT * FROM clients WHERE заказ IS NOT NULL; id |         ФИО          | страна проживания | заказ ----+----------------------+-------------------+-------  1 | Иванов Иван Иванович | USA               |     3  2 | Петров Петр Петрович | Canada            |     4  3 | Иоганн Себастьян Бах | Japan             |     5(3 rows)```Подсказка: используйте директиву `UPDATE`.## Задача 5Получите полную информацию по выполнению запроса выдачи всех пользователей из задачи 4 (используя директиву EXPLAIN).Приведите получившийся результат и объясните, что значат полученные значения.```test_db=# EXPLAIN ANALYZE SELECT * FROM clients WHERE заказ IS NOT NULL;                                             QUERY PLAN                                              ----------------------------------------------------------------------------------------------------- Seq Scan on clients  (cost=0.00..10.90 rows=90 width=842) (actual time=0.008..0.009 rows=3 loops=1)   Filter: ("заказ" IS NOT NULL)   Rows Removed by Filter: 2 Planning Time: 0.032 ms Execution Time: 0.017 ms(5 rows)Поиск происходил без исользования индексов. Расчётное время 32 мкс, фактическое - 17 мкс.```## Задача 6Создайте бэкап БД test_db и поместите его в volume, предназначенный для бэкапов (см. задачу 1).Остановите контейнер с PostgreSQL, но не удаляйте volumes.Поднимите новый пустой контейнер с PostgreSQL.Восстановите БД test_db в новом контейнере.Приведите список операций, который вы применяли для бэкапа данных и восстановления. ```pg_dump test_db > /var/lib/postgresql/data/backup/test_db.bak``````create database test_dbcreate user "test-simple-user";create user "test-admin-user";quitpsql test_db < /var/lib/postgresql/data/backup/test_db.bak```---### Как cдавать заданиеВыполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.---